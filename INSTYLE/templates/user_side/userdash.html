{% extends 'user_side/base_user.html' %}
{% load static %}
{% block content %}
<style>
    .no-outline {
        outline: none;
        box-shadow: none;
    }
    
    .no-outline:focus,
    .no-outline:active {
        outline: none;
        box-shadow: none;
    }
    .wallet-table th {
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.9em;
        color: #495057;
    }
    .wallet-table td {
        vertical-align: middle;
        font-size: 0.95em;
    }
    .transaction-type {
        font-weight: 600;
        padding: 0.25em 0.6em;
        border-radius: 20px;
    }
    .transaction-amount {
        font-weight: 700;
        font-size: 1.05em;
    }
    .transaction-date {
        color: #6c757d;
    }
    .transaction-description {
        max-width: 250px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }




    .nav.flex-column {
        border: 1px solid #d3d3d3; /* Light grey border for the ul */
        padding: 0;
        border-radius: 5px; /* Slight rounding of the corners */
    }
    
    .nav-item {
        background-color: #f5f5f5; /* Light grey background color for li */
        color: #333; /* Darker text color for contrast */
    }
    
    .nav-link {
        color: #333; /* Darker text color for links */
        padding: 10px 15px; /* Padding for links */
        border-bottom: 1px solid #d3d3d3; /* Light grey border between items */
        display: flex;
        align-items: center;
    }
    
    .nav-link.active {
        background-color: #e0e0e0; /* Slightly darker light grey for active link */
    }
    
    .nav-link:hover {
        background-color: #d0d0d0; /* Slightly darker grey for hover */
        text-decoration: none; /* Remove underline on hover */
    }
    
    .nav-link i {
        margin-right: 10px; /* Margin for icons */
    }
    
    .nav-item:last-child .nav-link {
        border-bottom: none; /* Remove bottom border for the last item */
    }


    .card-body {
        background-color: #f9f9f9; /* Light background color for the card body */
        padding: 20px; /* Padding for the card body */
        border-radius: 8px; /* Rounded corners */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
    }
    
    .form-group {
        margin-bottom: 20px; /* Space between form groups */
    }
    
    .form-group label {
        font-weight: bold; /* Bold labels */
        color: #333; /* Dark text color for labels */
        margin-bottom: 5px; /* Space between label and input */
        display: block; /* Ensure labels are block elements */
    }
    
    .form-group .required {
        color: #e74c3c; /* Red color for required field asterisk */
    }
    
    .form-control {
        border: 1px solid #d3d3d3; /* Light grey border for inputs */
        border-radius: 4px; /* Slight rounding of input corners */
        padding: 10px; /* Padding inside the input */
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1); /* Inner shadow for depth */
        width: 100%; /* Full width for inputs */
        box-sizing: border-box; /* Ensure padding doesn't affect width */
    }
    
    .form-control[readonly] {
        background-color: #e9ecef; /* Light background for readonly inputs */
        color: #6c757d; /* Slightly darker text for readonly inputs */
    }
    
    .form-label {
        font-weight: bold; /* Bold labels */
        color: #333; /* Dark text color for labels */
        margin-bottom: 5px; /* Space between label and input */
        display: block; /* Ensure labels are block elements */
    }
    
    .row {
        margin-right: -15px; /* Negative margin to offset row padding */
        margin-left: -15px; /* Negative margin to offset row padding */
    }
    
    .col-md-6 {
        padding-right: 15px; /* Padding for columns */
        padding-left: 15px; /* Padding for columns */
    }
    
    
    
      
</style>
<main class="main">
    <div class="page-header breadcrumb-wrap">
        <div class="container">
            <div class="breadcrumb">
                <a href="index.html" rel="nofollow"></a>
                <span></span> 
                <span></span> My Account
            </div>
        </div>
    </div>
    <section class="pt-50 pb-70">
        <div class="container">
            <div class="row">
                <div class="col-lg-10 m-auto">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="dashboard-menu">
                                <ul  class="nav flex-column" role="tablist">
                                    <li class="nav-item">
                                        <a  class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" href="#dashboard" role="tab" aria-controls="dashboard" aria-selected="false"><i class="fi-rs-settings-sliders mr-10"></i>Dashboard</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#orders" role="tab" aria-controls="orders" aria-selected="false"><i class="fi-rs-shopping-bag mr-10"></i>Orders</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab" href="#track-orders" role="tab" aria-controls="track-orders" aria-selected="false"><i class="fi-rs-shopping-cart-check mr-10"></i>Wallet</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address" role="tab" aria-controls="address" aria-selected="true"><i class="fi-rs-marker mr-10"></i>My Address</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="account-detail-tab" data-bs-toggle="tab" href="#account-add  " role="tab" aria-controls="account-detail" aria-selected="true"><i class="fi-rs-user mr-10"></i>Add Address</a>
                                    </li>
                                    
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'accounts:logout' %}"><i class="fi-rs-sign-out mr-10"></i>Logout</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-8 mb-5">
                            <div class="tab-content dashboard-content">
                                <div class="tab-pane fade active show" id="dashboard" role="tabpanel" aria-labelledby="dashboard-tab">
                                    <div class="card">
                                        <div class="card-body text-center"> 
                                            <div class="mb-3"> 
                                                <a   href="#"  aria-expanded="false"> <img class="img-xs rounded-circle" style="height:100px;" src="{% static 'logo/review_avatar.jpg' %}" alt="User"></a>
                                            </div> 
                                            <h5 class="card-title">{{ user.get_full_name }}</h5> 
                                            <p class="card-text text-muted">{{ user.email }}</p> 
                                            <a href="#" class="btn btn-outline-secondary btn-sm mt-2" data-bs-toggle="modal" data-bs-target="#editProfileModal">Edit Profile</a>

                                           <a href="#" class="btn btn-outline-secondary btn-sm mt-2" data-toggle="modal" data-target="#changePasswordModal">Change Password</a>


                                        </div>
                                        <div class="card-header">
                                            <h5 class="mb-0"> Hi  {{ user_data.first_name }} </h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="form-group col-md-6">
                                                    <label>First Name<span class="required">*</span></label>
                                                    <div class="form-control-plaintext">{{ user_data.first_name }}</div>
                                                </div>
                                                
                                                <div class="form-group col-md-6">
                                                    <label>Last Name<span class="required">*</span></label>
                                                    <div class="form-control-plaintext">{{ user_data.last_name }}</div>
                                                </div>
                                                
                                                <div class="form-group col-md-6">
                                                    <label>Email<span class="required">*</span></label>
                                                    <div class="form-control-plaintext">{{ user_data.email }}</div>
                                                </div>
                                                <div class="form-group col-md-6">
                                                    <label>Joined On<span class="required">*</span></label>
                                                    <div class="form-control-plaintext">{{ user_data.date_joined|date:"F d, Y" }}</div>
                                                </div>
                                                {% comment %} <div class="form-group col-md-6">
                                                    <label>Account Status<span class="required">*</span></label>
                                                    <div class="form-control-plaintext">{{ user.is_active|yesno:'Active,Inactive' }}</div>
                                                </div> {% endcomment %}
                                            </div>
                                        </div>
                                        
                                        
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Your Orders</h5>
                                        </div>
                                        
                                        <div class="card-body"> 
                                            <div class="table-responsive"> 
                                                <table class="table"> 
                                                    <thead> 
                                                        <tr> 
                                                            <th>Order ID</th> 
                                                            <th>Address</th> 
                                                            <th>Price</th> 
                                                            <th style="width:100px;">Date</th> 
                                                            <th>Status</th> 
                                                            <th>Action</th> 
                                                        </tr> 
                                                    </thead> 
                                                    {% for order in orders %}
                                                    <tbody> 
                                                        <tr> 
                                                            <td> 
                                                                {% if order_sub.variant.product.thumbnail %}
                                                                <img src="{% static '{{ product.thumbnail.url }}' %}"  alt="{{ order_sub.variant.product.product_name }}" style="width: 100px;"> 
                                                                {% endif %}
                                                                <div>Order ID:</div> 
                                                                <div>{{ order.order_id }}</div>
                                                            </td> 
                                                            
                                                            <td> 
                                                                {{ order.address.house_name }}<br> 
                                                                {{ order.address.district }}<br> 
                                                                {{ order.address.state}}<br>
                                                                {{ order.address.pin_number}} 
                                                            </td> 
                                                            <td>₹{{ order.final_amount }}</td> 
                                                            <td> 
                                                                {{ order.date }}<br>
                                                            </td>
                                                            <td>{% if order.order_status == "Delivery" %}
                                                                <span class="badge bg-success">Delivered</span>
                                                            {% else %}
                                                                <span class="badge 
                                                                    {% if order.order_status == "Confirmed" %} bg-warning 
                                                                    {% elif order.order_status == "Shipped" %} bg-primary 
                                                                    {% else %} bg-danger 
                                                                    {% endif %}">
                                                                    {{ order.order_status }}
                                                                </span>
                                                            {% endif %}</td>
                                                            <td>
                                                                <div>
                                                                    {% if order.order_status == "confirmed" or order.order_status == "Awaiting Payment" or order.order_status == "Shipped" %}
                                                                    <form id="cancel-order-form" method="post" action="{% url 'order:cancel_order' order.id %}">
                                                                        {% csrf_token %}
                                                                        <button type="submit" class="badge bg-danger no-outline" style="height: 25px; width: 100px; padding: 0; text-align: center; display: flex; align-items: center; justify-content: center;">
                                                                            Cancel Order
                                                                        </button>
                                                                    </form>
                                                                    {% endif %}
                                                                </div>
                                                                <div style="margin-top:10px;">
                                                                    {% if order.is_active and order.order_status == "Delivery" %}
                                                                    <form id="return-order-form" method="post" action="{% url 'order:return_order' order.id %}">
                                                                        {% csrf_token %}
                                                                        <button type="submit" class="badge bg-danger no-outline" style="height: 25px; width: 100px; padding: 0; text-align: center; display: flex; align-items: center; justify-content: center;">
                                                                            Return Order
                                                                        </button> 
                                                                    </form>
                                                                    {% endif %}
                                                                </div>
                                                                
                                                                <div style="margin-top:10px;">
                                                                    <button class="btn btn-danger btn-sm collapse-btn" type="button" data-bs-toggle="collapse" data-bs-target="#orderDetails{{ order.id }}" aria-expanded="false" aria-controls="orderDetails{{ order.id }}">
                                                                        Details
                                                                    </button>
                                                                </div>
                                                                {% if order.order_status == "Delivery" %}
                                                                <a href="{% url 'order:user_invoice' order.id %}" class="btn btn-sm" style="display: block; width: 100%; margin: 2px 0; padding: 6px 2px; font-size: 11px; line-height: 1.5; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle; cursor: pointer; border: 1px solid #000; border-radius: 3px; text-decoration: none; color: #fff; background-color: #000;">INVOICE DOWNLOAD</a>
                                                                {% endif %}
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td colspan="6" class="p-0">
                                                                <div class="collapse order-details" id="orderDetails{{ order.id }}">
                                                                    <div class="card card-body">
                                                                        {% for item in order.ordersub_set.all %}
                                                                        <div class="row mb-3">
                                                                            <div class="col-md-3">
                                                                                <img src="{{ item.variant.product.thumbnail.url }}" alt="{{ item.variant.product.product_name }}" class="img-fluid rounded">
                                                                            </div>
                                                                            <div class="col-md-9">
                                                                                <div class="row">
                                                                                    <div class="col-md-6">
                                                                                        <h5 class="card-title">{{ item.variant.product.product_name }}</h5>
                                                                                        <p class="card-text">
                                                                                            Quantity: {{ item.quantity }}<br>
                                                                                            Size: {{ item.variant.size }}<br>
                                                                                            Price: ₹{{ item.price }}
                                                                                        </p>
                                                                                    </div>
                                                                                    <div class="col-md-6">
                                                                                        <h5 class="card-title">Delivery Address</h5>
                                                                                        <p class="card-text">
                                                                                            Name:{{ item.main_order.address.name }}<br>
                                                                                            House Name: {{ item.main_order.address.house_name }}<br>
                                                                                            Size: {{ item.variant.size }}<br>
                                                                                            Price: ₹{{ item.variant.product.offer_price }}<br>
                                                                                            
                                                                                        </p>
                                                                                    </div>
                                                                                </div>
                                                                                {% if item.is_active and item.main_order.is_active and  item.main_order.order_status == "Delivery" %}
                                                                                
                                                                                    <form class="item-return-form" method="post" action="{% url 'order:individual_return' item.id %}">
                                                                                        {% csrf_token %}
                                                                                        <button type="submit" class="btn btn-danger btn-sm collapse-btn">Return</button>
                                                                                    </form>
                                                                                {% endif %}
                                                                            </div>
                                                                        </div>
                                                                        {% endfor %}
                                                                    </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody> 
                                                    {% endfor %}
                                                </table> 
                                            </div> 
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Include Bootstrap JS for collapse functionality -->
                                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
                                <div class="tab-pane fade" id="track-orders" role="tabpanel" aria-labelledby="track-orders-tab">
                                    <div class="card shadow-sm">
                                        <div class="card-header bg-light d-flex justify-content-between align-items-center py-3">
                                            <h5 class="mb-0 text-danger font-weight-bold">Wallet</h5>
                                            <h4 class="mb-0 font-weight-bold">Balance: <span class="text-danger">₹{{ balance }}</span></h4>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover ">
                                                    <thead class="thead-light">
                                                        <tr>
                                                            <th scope="col">Transaction Type</th>
                                                            <th scope="col">Amount</th>
                                                            <th style="width:100px;" scope="col">Date</th>
                                                            <th scope="col">Description</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for item in transactions %}
                                                        <tr>
                                                            <td>
                                                                <span class="badge {% if item.transaction_type == 'Credited' %}badge-success{% else %}badge-danger{% endif %} px-2 py-1">
                                                                    {{ item.transaction_type }}
                                                                </span>
                                                            </td>
                                                            <td class="font-weight-bold {% if item.transaction_type == 'Credited' %}text-success{% else %}text-danger{% endif %}">
                                                                ₹{{ item.amount }}
                                                            </td>
                                                            <td>{{ item.date|date:"M d, Y" }}</td>
                                                            <td>{{ item.description }}</td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% comment %} <a href="{% url 'user_panel:create_address' %}"><button class="btn btn-danger btn-sm mb-5" style="color: white; border: none; outline: none; padding: 5px 10px; border-radius: 3px; ">
                                    Create Address
                                </button></a> {% endcomment %}
                                <div class="tab-pane fade" id="address" role="tabpanel" aria-labelledby="address-tab">
                                    <div class="row">
                                        {% for address in user_address %}
                                        <div class="col-lg-6">
                                            <div class="card mb-3">
                                                <div class="card-header d-flex justify-content-between align-items-center">
                                                    <h5 class="mb-0">{{ address.name }}</h5>
                                                    <a href="{% url 'userdash:default' address.id %}" style="color:red" class="btn btn-sm btn-link">
                                                        {% if address.status %}
                                                            Default
                                                        {% else %}
                                                            Make as Default
                                                        {% endif %}
                                                    </a>
                                                </div>
                                                <div class="card-body">
                                                    <address>
                                                        {{ address.house_name }}<br>
                                                        {{ address.street_name }}<br>
                                                        {{ address.pin_number }}<br>
                                                        {{ address.district }}<br>
                                                        {{ address.state }}<br>
                                                        {{ address.phone_number }}
                                                    </address>
                                                    <p>{{ address.country }}</p>
                                                
                                                    <div class="d-flex justify-content-end">
                                                        <a href="{% url 'userdash:edit_address' address.id %}" class="btn btn-sm btn-link" >Edit</a>
                                                  
                                                        <span class="mx-2">|</span>
                                                            <a href="{% url 'userdash:delete_address' address.id %}"    class="btn btn-sm {% if user_data.status %}btn-success{% else %}btn-danger{% endif %}">delete</a>
                                                                
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {% empty %}
                                        <p>No addresses found.</p>
                                        {% endfor %}
                                    </div>
                                </div>
                                
                                
                                <div class="tab-pane fade" id="account-add" role="tabpanel" aria-labelledby="account-detail-tab" style="width:800px">
                                    <div style="" class="r">
                                        <h2>Add Address</h2>
                                    </div>
                                    <div class="card-body">
                                        <form method="post" action="{% url 'userdash:create_address' %}" name="edit_address_form">
                                            {% csrf_token %}
                                            <div class="row">
                                                <div class="form-group col-md-6">
                                                    <label>Name <span class="required">*</span></label>
                                                    <input required class="form-control square" name="name" type="text">
                                                </div>
                                                <div class="form-group col-md-6">
                                                    <label>House Name <span class="required">*</span></label>
                                                    <input required class="form-control square" name="house_name">
                                                </div>
                                                <div class="form-group col-md-6">
                                                    <label>Street Name <span class="required">*</span></label>
                                                    <input required class="form-control square" name="street_name" type="text">
                                                </div>
                                                <div class="form-group col-md-6">
                                                    <label>Pin Number <span class="required">*</span></label>
                                                    <input required class="form-control square" name="pin_number">
                                                </div>
                                                <div class="form-group col-md-6">
                                                    <label>District <span class="required">*</span></label>
                                                    <input required class="form-control square" name="district" type="text">
                                                </div>
                                                <div class="form-group col-md-6">
                                                    <label>State <span class="required">*</span></label>
                                                    <input required class="form-control square" name="state">
                                                </div>
                                                <div class="form-group col-md-6">
                                                    <label>Country <span class="required">*</span></label>
                                                    <input required class="form-control square" name="country" type="text">
                                                </div>
                                                <div class="form-group col-md-6">
                                                    <label>Phone Number <span class="required">*</span></label>
                                                    <input required class="form-control square" name="phone_number">
                                                </div>
                                                <div class="form-group col-md-6 ">
                                                    <input type="checkbox"  id="is_active" name="status" {% if users.status %}checked{% endif %}>
                                                    <label class="form-check-label mr-0" for="is_active">Make default</label>
                                                </div>
                                                <div class="col-md-12">
                                                    <button type="submit" class="btn btn-fill-out submit" name="submit" value="Submit">Save</button>
                                                </div>
                                            </div>
                                        </form>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Bootstrap Modal -->
<div class="modal fade" id="reasonModal" tabindex="-1" aria-labelledby="reasonModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="reasonModalLabel">Provide a Reason</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="reason-form" method="post" action="">
            <div class="mb-3">
              <label for="reason-text" class="form-label">Reason</label>
              <textarea class="form-control" id="reason-text" rows="3" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="changePasswordModalLabel">Change Password</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="changePasswordForm" method="post" action="{% url 'userdash:change_password' %}">
            {% csrf_token %}
            <div class="form-group">
              <label for="currentPassword">Current Password</label>
              <input type="password" class="form-control" id="currentPassword" placeholder="Enter current password"  name="old_password" required>
            </div>
            <div class="form-group">
              <label for="newPassword">New Password</label>
              <input type="password" class="form-control" id="newPassword" placeholder="Enter new password"  name="new_password" required>
            </div>
            <div class="form-group">
              <label for="confirmPassword">Confirm New Password</label>
              <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm new password"  name="confirm_password" required>
            </div>
            <button type="submit" class="btn btn-primary" form="changePasswordForm">Save changes</button>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Modal body content (e.g., form) goes here -->
          <form  method="post" action="{% url 'userdash:edit_profile' %}">
            {% csrf_token %}
            <div class="mb-3">
              <label for="profileName" class="form-label">first_Name</label>
              <input type="text" class="form-control" id="profileName" name="firstname" value={{user.first_name}} >
            </div>
            <div class="mb-3">
              <label for="profileEmail" class="form-label">Lastname</label>
              <input type="text" class="form-control" id="profileEmail" name="lastname" value={{user.last_name}}>
            </div>
            
            <button type="submit" class="btn btn-primary">Save changes</button>
            <!-- Add more form fields as needed -->
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          
        </div>
      </div>
    </div>
  </div>
  
  <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editModalLabel">Edit Item</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Add your form or content here -->
          <form>
            <div class="form-group col-md-6">
                <label>Name <span class="required">*</span></label>
                <input required class="form-control square" name="name" type="text" >
            </div>
            <div class="form-group col-md-6">
                <label>House Name <span class="required">*</span></label>
                <input required class="form-control square" name="house_name" >
            </div>
            <div class="form-group col-md-6">
                <label>Street Name <span class="required">*</span></label>
                <input required class="form-control square" name="street_name" type="text" >
            </div>
            <div class="form-group col-md-6">
                <label>Pin Number <span class="required">*</span></label>
                <input required class="form-control square" name="pin_number">
            </div>
            <div class="form-group col-md-6">
                <label>District <span class="required">*</span></label>
                <input required class="form-control square" name="district" type="text" >
            </div>
            <div class="form-group col-md-6">
                <label>State <span class="required">*</span></label>
                <input required class="form-control square" name="state" >
            </div>
            <div class="form-group col-md-6">
                <label>Country <span class="required">*</span></label>
                <input required class="form-control square" name="country" type="text">
            </div>
            <div class="form-group col-md-6">
                <label>Phone Number <span class="required">*</span></label>
                <input required class="form-control square" name="phone_number" >
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Return Order Confirmation Modal -->
  <div class="modal fade" id="reasonModal" tabindex="-1" aria-labelledby="reasonModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reasonModalLabel">Provide Reason</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="reason-form">
                    <div class="mb-3">
                        <label for="reason-text" class="form-label">Reason:</label>
                        <textarea class="form-control" id="reason-text" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>
  </div>
  

  
</main>

<script>
    /*

        document.getElementById('addressForm').addEventListener('submit', function(event) {
            var form = this;
            var isValid = true;
            var fields = [
                { name: 'name', pattern: /^[A-Za-z\s]{2,50}$/ }, 
                { name: 'house_name', pattern: /^.{1,100}$/ },
                { name: 'street_name', pattern: /^.{2,100}$/ },
                { name: 'pin_number', pattern: /^[0-9]{5,6}$/ },
                { name: 'district', pattern: /^[A-Za-z\s]{2,50}$/ },
                { name: 'state', pattern: /^[A-Za-z\s]{2,50}$/ },
                { name: 'country', pattern: /^[A-Za-z\s]{2,50}$/ },
                { name: 'phone_number', pattern: /^[0-9]{10}$/ }
            ];
    
            fields.forEach(function(field) {
                var input = form[field.name];
                var value = input.value.trim();
                if (!field.pattern.test(value)) {
                    isValid = false;
                    input.style.borderColor = 'red';
                } else {
                    input.style.borderColor = '';
                }
                input.value = value; // Remove leading/trailing spaces
            });
    
            if (!isValid) {
                event.preventDefault(); // Prevent form submission if validation fails
                alert('Please fill out all required fields correctly.');
            }
        });
    */
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
    {% if messages %}
        const messages = [
            {% for message in messages %}
                "{{ message }}",
            {% endfor %}
        ];
        messages.forEach(message => {
            Swal.fire({
                toast: true,
                position: 'button-right',
                icon: 'success',
                title: message,
                showConfirmButton: false,
                timer: 3000
            });
        });
    {% endif %}
});

document.addEventListener('DOMContentLoaded', function() {
    // Function to handle SweetAlert confirmation
    function handleSweetAlert(form, title, text) {
        form.addEventListener('submit', function(event) {
            event.preventDefault();
            
            Swal.fire({
                title: title,
                text: text,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, do it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Show the reason modal
                    const reasonModal = new bootstrap.Modal(document.getElementById('reasonModal'));
                    reasonModal.show();

                    // Handle reason form submission
                    const reasonForm = document.getElementById('reason-form');
                    reasonForm.addEventListener('submit', function(event) {
                        event.preventDefault();
                        
                        // Get the reason from the textarea
                        const reason = document.getElementById('reason-text').value;

                        // Add the reason to the form as a hidden input
                        const hiddenInput = document.createElement('input');
                        hiddenInput.type = 'hidden';
                        hiddenInput.name = 'reason';
                        hiddenInput.value = reason;
                        form.appendChild(hiddenInput);

                        // Submit the original form
                        form.submit();
                    });
                }
            });
        });
    }

    // Cancel order form
    const cancelForm = document.getElementById('cancel-order-form');
    if (cancelForm) {
        handleSweetAlert(cancelForm, 'Are you sure?', 'Do you really want to cancel this order?');
    }

    // Return order form
    const returnForm = document.getElementById('return-order-form');
    if (returnForm) {
        handleSweetAlert(returnForm, 'Are you sure?', 'Do you really want to return this order?');
    }
});

</script>

<!-- Include Bootstrap JS for collapse functionality -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Custom script to ensure only one collapse is open at a time -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var collapseButtons = document.querySelectorAll('.collapse-btn');
        collapseButtons.forEach(function (button) {
            button.addEventListener('click', function () {
                var currentCollapse = document.querySelector('.collapse.show');
                if (currentCollapse && currentCollapse !== this.nextElementSibling) {
                    var collapseInstance = bootstrap.Collapse.getInstance(currentCollapse);
                    if (collapseInstance) {
                        collapseInstance.hide();
                    }
                }
            });
        });
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        let currentForm;
    
        function handleConfirmation(form, title, text, isReturn = false) {
            form.addEventListener('submit', function(event) {
                event.preventDefault();
                event.stopPropagation();
                
                Swal.fire({
                    title: title,
                    text: text,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, proceed'
                }).then((result) => {
                    if (result.isConfirmed) {
                        if (isReturn) {
                            currentForm = form;
                            const reasonModal = new bootstrap.Modal(document.getElementById('reasonModal'));
                            reasonModal.show();
                        } else {
                            form.submit();
                        }
                    }
                });
            });
        }
    
        // Handle reason form submission
        const reasonForm = document.getElementById('reason-form');
        reasonForm.addEventListener('submit', function(event) {
            event.preventDefault();
            
            const reason = document.getElementById('reason-text').value;
            const hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.name = 'reason';
            hiddenInput.value = reason;
            currentForm.appendChild(hiddenInput);
    
            const reasonModal = bootstrap.Modal.getInstance(document.getElementById('reasonModal'));
            reasonModal.hide();
            currentForm.submit();
        });
    
        // Order-level cancel
        const cancelOrderForms = document.querySelectorAll('#cancel-order-form');
        cancelOrderForms.forEach(form => {
            handleConfirmation(form, 'Cancel Order?', 'Are you sure you want to cancel this order?');
        });
    
        // Order-level return
        const returnOrderForms = document.querySelectorAll('#return-order-form');
        returnOrderForms.forEach(form => {
            handleConfirmation(form, 'Return Order?', 'Are you sure you want to return this order?', true);
        });
    
        // Item-level cancel
        const itemCancelForms = document.querySelectorAll('.item-cancel-form');
        itemCancelForms.forEach(form => {
            handleConfirmation(form, 'Cancel Item?', 'Are you sure you want to cancel this item?');
        });
    
        // Item-level return
        const itemReturnForms = document.querySelectorAll('.item-return-form');
        itemReturnForms.forEach(form => {
            handleConfirmation(form, 'Return Item?', 'Are you sure you want to return this item?', true);
        });
    });
    
</script>


{% endblock %} 


